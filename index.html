<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>İnterkom Kontrol Paneli</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    margin:0; padding:0;
    background: linear-gradient(to bottom, #e0f7fa, #80deea);
    display:flex; flex-direction:column; align-items:center; min-height:100vh;
  }
  h1 { margin:20px 0; font-size:28px; color:#004d40; text-shadow:1px 1px 2px #ccc; }
  
  #statusBar {
    display:flex; justify-content:space-around; align-items:center;
    width:90%; max-width:500px;
    font-size:20px; font-weight:bold; margin:20px 0;
  }
  
  #wifiState {
    font-size:28px; font-weight:bold; transition: all 0.5s; }
  
  #callCount { font-size:26px; color:#00695c; transition: transform 0.3s; }
  
  #callButtons {
    margin:40px 0;
    display:flex; flex-direction:column; align-items:center; gap:20px;
  }
  
  button {
    font-size:24px; padding:20px 40px; border:none; border-radius:15px;
    cursor:pointer; color:white; transition: transform 0.2s, background 0.3s, box-shadow 0.3s;
    box-shadow:0 4px 8px rgba(0,0,0,0.2);
  }
  button:active { transform:scale(0.95); box-shadow:0 2px 4px rgba(0,0,0,0.2); }
  #startCall { background:#43a047; }
  #stopCall { background:#e53935; }
  
  #micStatus {
    font-size:24px; margin-top:30px; min-height:30px;
    font-weight:bold; text-align:center; transition: all 0.5s;
  }

  /* Animasyonlar */
  .pulse { animation:pulseAnim 1s ease-out; }
  @keyframes pulseAnim {
    0%{transform:scale(1);} 50%{transform:scale(1.2);} 100%{transform:scale(1);}
  }

  @media(max-width:600px){
    button{ width:80%; font-size:22px; }
    #statusBar{ flex-direction:column; gap:15px; }
  }
</style>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>

<h1>İnterkom Kontrol Paneli</h1>

<div id="statusBar">
  <div>WiFi: <span id="wifiState">BAĞLANIYOR...</span></div>
  <div>Gelen Çağrı Sayısı: <span id="callCount">0</span></div>
</div>

<div id="callButtons">
  <button id="startCall">Konuşmayı Başlat</button>
  <button id="stopCall">Konuşmayı Kapat</button>
</div>

<div id="micStatus"></div>

<script>
let callCount = parseInt(localStorage.getItem('callCount') || 0);
document.getElementById('callCount').innerText = callCount;

// MQTT Bağlantısı
const client = mqtt.connect('wss://c5ee8fc7589a4e05a56c2ae5a533f701.s1.eu.hivemq.cloud:8884/mqtt',{username:'Ygmur456', password:'Ygmur789'});

client.on('connect', function(){
  console.log('MQTT Bağlandı');
  client.subscribe('wifiStatus');
  client.subscribe('micStatus');
  client.subscribe('relay1');
});

client.on('message', function(topic, message){
  const msg = message.toString();

  if(topic === 'wifiStatus'){
    let el = document.getElementById('wifiState');
    el.innerText = msg;
    if(msg==='BAĞLI'){ el.style.color='green'; } 
    else { el.style.color='red'; }
    el.classList.add('pulse');
    setTimeout(()=>{el.classList.remove('pulse');},500);
  }

  if(topic === 'micStatus'){
    let el = document.getElementById('micStatus');
    el.innerText = (msg==='ON')?'Mikrofon Açık, Konuşabilirsiniz!':'Mikrofon Kapalı, Konuşma Bitti!';
    el.style.color = (msg==='ON')?'green':'red';
    el.classList.add('pulse');
    setTimeout(()=>{el.classList.remove('pulse'); el.innerText='';},3000);
  }

  if(topic === 'relay1'){
    callCount++;
    localStorage.setItem('callCount', callCount);
    let el = document.getElementById('callCount');
    el.innerText = callCount;
    el.classList.add('pulse');
    setTimeout(()=>{el.classList.remove('pulse');},300);
  }
});

// Buton olayları
document.getElementById('startCall').addEventListener('click', ()=>{
  client.publish('relay1','TRIG');
});
document.getElementById('stopCall').addEventListener('click', ()=>{
  client.publish('relay2','TRIG');
});
</script>

</body>
</html>

