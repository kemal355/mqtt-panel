<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>İnterkom Kontrol Paneli</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    text-align: center;
    margin: 0; padding: 0;
    background: #f4f6f8;
  }

  h1 {
    margin-top: 20px;
    font-size: 26px;
    color: #333;
  }

  #statusBar {
    display: flex;
    justify-content: space-around;
    align-items: center;
    margin: 25px 10px;
    font-size: 20px;
    font-weight: bold;
  }

  #wifiState {
    font-size: 24px;
    font-weight: bold;
    color: gray;
    transition: color 0.5s, transform 0.3s;
  }

  #callCount {
    font-size: 26px;
    color: #222;
  }

  #callButtons {
    margin: 40px 0;
  }

  button {
    font-size: 22px;
    padding: 15px 35px;
    margin: 15px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    color: white;
    transition: transform 0.2s;
  }

  button:active {
    transform: scale(0.95);
  }

  #startCall { background: #28a745; }
  #stopCall { background: #dc3545; }

  #micStatus {
    margin-top: 25px;
    font-size: 22px;
    color: #0044cc;
    min-height: 28px;
    transition: opacity 0.5s;
  }

  @media(max-width:600px){
    button { width: 80%; font-size: 24px; }
    #statusBar { flex-direction: column; gap: 15px; }
  }
</style>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>

<h1>İnterkom Kontrol Paneli</h1>

<div id="statusBar">
  <div>WiFi: <span id="wifiState">BAĞLANIYOR...</span></div>
  <div>Gelen Çağrı Sayısı: <span id="callCount">0</span></div>
</div>

<div id="callButtons">
  <button id="startCall">Konuşmayı Başlat</button>
  <button id="stopCall">Konuşmayı Kapat</button>
</div>

<div id="micStatus"></div>

<script>
let callCount = localStorage.getItem('callCount') || 0;
document.getElementById('callCount').innerText = callCount;

const client = mqtt.connect('wss://6db25b9004e64ab084db4a92d1576615.s1.eu.hivemq.cloud:8884/mqtt',{
  username:'kemal123',
  password:'Kemal12345'
});

client.on('connect', function(){
  console.log('MQTT bağlandı');
  client.subscribe('wifiStatus');
  client.subscribe('micStatus');
  client.subscribe('relay1');
});

client.on('message', function(topic, message){
  const msg = message.toString();

  if(topic === 'wifiStatus'){
    let el = document.getElementById('wifiState');
    if(msg === 'Bağlı'){
      el.innerText = 'BAĞLI';
      el.style.color = 'green';
      el.style.transform = 'scale(1.2)';
      setTimeout(()=>{el.style.transform='scale(1)';}, 300);
    } else {
      el.innerText = 'BAĞLI DEĞİL';
      el.style.color = 'red';
      el.style.transform = 'scale(1.2)';
      setTimeout(()=>{el.style.transform='scale(1)';}, 300);
    }
  }

  if(topic === 'micStatus'){
    let el = document.getElementById('micStatus');
    if(msg === 'ON'){
      el.innerText = 'Mikrofon Açık, Konuşabilirsiniz!';
    } else if(msg === 'OFF'){
      el.innerText = 'Mikrofon Kapalı, Konuşma Bitti!';
    }
    el.style.opacity = '1';
    setTimeout(()=>{el.style.opacity='0';}, 3000);
  }

  if(topic === 'relay1'){
    callCount++;
    localStorage.setItem('callCount', callCount);
    document.getElementById('callCount').innerText = callCount;
  }
});

document.getElementById('startCall').addEventListener('click', ()=>{
  client.publish('relay1','TRIG');
});

document.getElementById('stopCall').addEventListener('click', ()=>{
  client.publish('relay2','TRIG');
});
</script>

</body>
</html>
